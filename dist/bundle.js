!function(){"use strict";const e={greenFormats:["17","18","22"],blueFormats:["139","140","141","249","250","251","599","600"],defaultColor:"#9e0cf2"};function t(e){if(!e||"string"!=typeof e)return console.error("Invalid URL provided to getVideoId:",e),null;try{const t=new URL(e);if(["www.youtube.com","youtube.com","youtu.be"].includes(t.hostname)){if("youtu.be"===t.hostname){const e=t.pathname.slice(1);return 11===e.length?e:null}if(t.hostname.includes("youtube.com")){if(t.pathname.startsWith("/shorts/"))return t.pathname.split("/")[2];const e=t.searchParams.get("v");return e&&11===e.length?e:null}}if(["www.facebook.com","facebook.com","m.facebook.com","web.facebook.com"].includes(t.hostname)){if(t.pathname.startsWith("/reel/"))return t.pathname.split("/")[2];const e=t.pathname.match(/\/(?:videos?|reel)\/(\d+)/);if(e)return e[1]}return console.warn("Unrecognized video URL format:",e),null}catch(e){return console.error("Error parsing URL in getVideoId:",e),null}}function o(e){return DOMPurify.sanitize(e)}function n(e,t){const o=document.getElementById(e);o?o.innerHTML=t:console.warn(`Element with ID "${e}" not found.`)}function r(i,l=1){const s=`https://vkrdownloader.xyz/server?api_key=vkrdownloader&vkr=${encodeURIComponent(i)}`,d=l;$.ajax({url:s,type:"GET",cache:!0,async:!0,crossDomain:!0,dataType:"json",timeout:15e3,success:function(r){!function(r,i){if(document.getElementById("container").style.display="block",document.getElementById("loading").style.display="none",r.data){const l=r.data,s=l.downloads.map(e=>e.url),d=l.source,c=t(d),u=d&&(d.includes("youtube.com")||d.includes("youtu.be")),p=u&&c?`https://i.ytimg.com/vi/${c}/hqdefault.jpg`:l.thumbnail,m=`\n  <video style='background: black url(${p}) center center/cover no-repeat; width:100%; height:500px; border-radius:20px;' \n         poster='${p}' controls playsinline>\n      <source src='${l.downloads[5]?.url||""}' type='video/mp4'>\n      ${Array.isArray(s)?s.map(e=>`<source src='${e}' type='video/mp4'>`).join(""):""}\n      <source src='https://vkrdownloader.xyz/server/dl.php?vkr=${encodeURIComponent(i)}' type='video/mp4'>\n  </video>`,h=`\n          <video style='background: black url(${p}) center center/cover no-repeat; width:100%; height:500px; border-radius:20px;' \n                 poster='${p}' controls playsinline>\n               <source src='https://vkrdownloader.xyz/server/redirect.php?vkr=https://youtu.be/${c}' type='video/mp4'>\n               <source src='https://vkrdownloader.xyz/server/dl.php?vkr=${i}' type='video/mp4'>\n              ${s.map(e=>`<source src='${e}' type='video/mp4'>`).join("")}\n          </video>`,y=l.title?`<h3>${o(l.title)}</h3>`:"",f=l.description?`<h4><details><summary>View Description</summary>${o(l.description)}</details></h4>`:"",g=l.size?`<h4>${o(l.size)}</h4>`:"",v=l.uploader?`<div><i class="bi bi-person-circle me-2"></i>${o(l.uploader)}</div>`:"",w=l.extractor?`<div><i class="bi bi-gear me-2"></i>Extracted via: ${o(l.extractor)}</div>`:"",b=l.downloads&&l.downloads.length>0?`<div><i class="bi bi-link-45deg me-2"></i>Available formats: ${l.downloads.length}</div>`:"";n("thumb",u&&c?h:m),n("title",y),n("description",f),n("duration",g),n("uploader",v),n("extractor",w),n("downloadURL",b),function(n){const r=document.getElementById("download");if(r.innerHTML="",n.data){const a=n.data.downloads,i=n.data.source,l=t(i);if(i&&(i.includes("youtube.com")||i.includes("youtu.be"))&&l){["mp3","360","720","1080"].forEach(e=>{r.innerHTML+=`\n    <iframe style="border: 0; outline: none; display:inline; min-width: 150px; max-height: 45px; height: 45px !important; margin-top: 10px; overflow: hidden;"   sandbox="allow-scripts allow-same-origin allow-popups allow-popups-to-escape-sandbox allow-downloads allow-downloads-without-user-activation"  scrolling="no"\n     src="https://vkrdownloader.xyz/server/dlbtn.php?q=${encodeURIComponent(e)}&vkr=${encodeURIComponent(i)}">\n     </iframe>`})}a.forEach(t=>{if(t&&t.url){const i=t.url,l=function(e,t){e=e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");const o=new RegExp(`[?&]${e}(=([^&#]*)|&|#|$)`).exec(t);return o&&o[2]?decodeURIComponent(o[2].replace(/\+/g," ")):""}("itag",i),s=(a=l,e.greenFormats.includes(a)?"green":e.blueFormats.includes(a)?"#3800ff":e.defaultColor),d=t.format_id,c=t.size,u=s===e.defaultColor?"#3f5974":s,p=`https://vkrdownloader.xyz/forcedl?forceT=${n.data.title}&forceD=${encodeURIComponent(i)}`;r.innerHTML+=`\n<button class="dlbtns" style="background:${u}; color: white; font-weight: bold;" onclick="window.location.href='${p}'">\n  ${o(d)} - ${o(c)}\n</button>\n`}var a})}else a("No download links found or data structure is incorrect."),document.getElementById("loading").style.display="none";""===r.innerHTML.trim()&&(a("Server Down due to Too Many Requests. Please contact us on Social Media @TheOfficialVKr."),document.getElementById("container").style.display="none")}(r)}else a("Issue: Unable to retrieve the download link. Please check the URL and contact us on Social Media @TheOfficialVKr."),document.getElementById("loading").style.display="none"}(r,i)},error:function(e,t,o){if(l>0){let e=3e3*Math.pow(2,d-l);console.log(`Retrying in ${e/1e3} seconds... (${l} attempts left)`),setTimeout(()=>r(i,l-1),e)}else{const n=function(e,t,o){const n=e.status;let r=`Status: ${t}, Error: ${o}`;if(e.responseText)try{const t=JSON.parse(e.responseText);t&&t.error&&(r+=`, Server Error: ${t.error}`)}catch(e){r+=", Unable to parse server response."}switch(n){case 0:return"Network Error: The server is unreachable.";case 400:return"Bad Request: The input URL might be incorrect.";case 401:return"Unauthorized: Please check the API key.";case 429:return"Too Many Requests: You are being rate-limited.";case 503:return"Service Unavailable: The server is temporarily overloaded.";default:return`${r}, HTTP ${n}: ${e.statusText||o}`}}(e,t,o);console.error(`Error Details: ${n}`),a("Unable to fetch the download link after several attempts. Please check the URL or try again and Click agin on Download Button or Refresh web Page."),document.getElementById("loading").style.display="none"}},complete:function(){document.getElementById("downloadBtn").disabled=!1}})}function a(e){const t=document.getElementById("error");t?(t.innerHTML=o(e),t.style.display="block"):alert(e)}document.getElementById("downloadBtn").addEventListener("click",function(e,t){let o;return function(...n){clearTimeout(o),o=setTimeout(()=>e.apply(this,n),t)}}(function(){document.getElementById("loading").style.display="initial",document.getElementById("downloadBtn").disabled=!0;const e=document.getElementById("inputUrl").value.trim();if(!e)return a("Please enter a valid video URL."),document.getElementById("loading").style.display="none",void(document.getElementById("downloadBtn").disabled=!1);r(e)},300))}();
