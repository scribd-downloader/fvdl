!function(){"use strict";const e={greenFormats:["17","18","22"],blueFormats:["139","140","141","249","250","251","599","600"],defaultColor:"#9e0cf2"};function t(e){if(!e||"string"!=typeof e)return console.error("Invalid URL provided to getVideoId:",e),null;try{const t=new URL(e);if(["www.youtube.com","youtube.com","youtu.be"].includes(t.hostname)){if("youtu.be"===t.hostname){const e=t.pathname.slice(1);return 11===e.length?e:null}if(t.hostname.includes("youtube.com")){if(t.pathname.startsWith("/shorts/"))return t.pathname.split("/")[2];const e=t.searchParams.get("v");return e&&11===e.length?e:null}}if(["www.facebook.com","facebook.com","m.facebook.com","web.facebook.com"].includes(t.hostname)){if(t.pathname.startsWith("/reel/"))return t.pathname.split("/")[2];const e=t.pathname.match(/\/(?:videos?|reel)\/(\d+)/);if(e)return e[1]}return console.warn("Unrecognized video URL format:",e),null}catch(e){return console.error("Error parsing URL in getVideoId:",e),null}}function o(e){return DOMPurify.sanitize(e)}function n(e,t){const o=document.getElementById(e);o?o.innerHTML=t:console.warn(`Element with ID "${e}" not found.`)}function r(a,l=2,s=0){const c=[`/api/proxy?url=${encodeURIComponent(a)}`,`https://vkrdownloader.xyz/server?api_key=vkrdownloader&vkr=${encodeURIComponent(a)}`,`https://api.socialdownloader.com/api/facebook?url=${encodeURIComponent(a)}`,`https://cors-anywhere.herokuapp.com/https://vkrdownloader.xyz/server?api_key=vkrdownloader&vkr=${encodeURIComponent(a)}`],d=c[s]||c[0],u=l;$.ajax({url:d,type:"GET",cache:!1,async:!0,crossDomain:!0,dataType:"json",timeout:2e4,headers:{Accept:"application/json","Content-Type":"application/json"},success:function(r){console.log(`API ${s+1} succeeded:`,r),function(r){if(document.getElementById("container").style.display="block",document.getElementById("loading").style.display="none",r.data){const a=r.data,l=a.downloads.map(e=>e.url),s=a.source,c=t(s),d=s&&(s.includes("youtube.com")||s.includes("youtu.be")),u=d&&c?`https://i.ytimg.com/vi/${c}/hqdefault.jpg`:a.thumbnail,m=`\n  <video style='background: black url(${u}) center center/cover no-repeat; width:100%; height:500px; border-radius:20px;' \n         poster='${u}' controls playsinline>\n      <source src='${a.downloads[5]?.url||""}' type='video/mp4'>\n      ${Array.isArray(l)?l.map(e=>`<source src='${e}' type='video/mp4'>`).join(""):""}\n  </video>`,p=`\n          <video style='background: black url(${u}) center center/cover no-repeat; width:100%; height:500px; border-radius:20px;' \n                 poster='${u}' controls playsinline>\n              ${l.map(e=>`<source src='${e}' type='video/mp4'>`).join("")}\n          </video>`,y=a.title?`<h3>${o(a.title)}</h3>`:"",h=a.description?`<h4><details><summary>View Description</summary>${o(a.description)}</details></h4>`:"",f=a.size?`<h4>${o(a.size)}</h4>`:"",g=a.uploader?`<div><i class="bi bi-person-circle me-2"></i>${o(a.uploader)}</div>`:"",b=a.extractor?`<div><i class="bi bi-gear me-2"></i>Extracted via: ${o(a.extractor)}</div>`:"",v=a.downloads&&a.downloads.length>0?`<div><i class="bi bi-link-45deg me-2"></i>Available formats: ${a.downloads.length}</div>`:"";n("thumb",d&&c?p:m),n("title",y),n("description",h),n("duration",f),n("uploader",g),n("extractor",b),n("downloadURL",v),function(n){const r=document.getElementById("download");if(r.innerHTML="",n.data){const i=n.data.downloads,a=n.data.source,l=t(a);if(a&&(a.includes("youtube.com")||a.includes("youtu.be"))&&l){["mp3","360","720","1080"].forEach(e=>{r.innerHTML+=`\n    <button class="dlbtns" style="background: #3f5974; color: white; font-weight: bold; margin: 5px;" onclick="forceDownload('${a}', 'video_${e}.mp4')">\n      Download ${e.toUpperCase()}\n    </button>`})}i.forEach(t=>{if(t&&t.url){const a=t.url,l=function(e,t){e=e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");const o=new RegExp(`[?&]${e}(=([^&#]*)|&|#|$)`).exec(t);return o&&o[2]?decodeURIComponent(o[2].replace(/\+/g," ")):""}("itag",a),s=(i=l,e.greenFormats.includes(i)?"green":e.blueFormats.includes(i)?"#3800ff":e.defaultColor),c=t.format_id,d=t.size,u=s===e.defaultColor?"#3f5974":s;r.innerHTML+=`\n<button class="dlbtns" style="background:${u}; color: white; font-weight: bold;" onclick="forceDownload('${a}', '${n.data.title||"video"}_${c}.mp4')">\n  ${o(c)} - ${o(d)}\n</button>\n`}var i})}else i("No download links found or data structure is incorrect."),document.getElementById("loading").style.display="none";""===r.innerHTML.trim()&&(i("Server Down due to Too Many Requests. Please contact us on Social Media @TheOfficialVKr."),document.getElementById("container").style.display="none")}(r)}else i("Issue: Unable to retrieve the download link. Please check the URL and contact us on Social Media @TheOfficialVKr."),document.getElementById("loading").style.display="none"}(r)},error:function(e,t,o){if(console.log(`API ${s+1} failed: ${d}`),s<c.length-1)console.log("Trying next API endpoint..."),setTimeout(()=>r(a,l,s+1),1e3);else if(l>0){let e=3e3*Math.pow(2,u-l);console.log(`All APIs failed. Retrying in ${e/1e3} seconds... (${l} attempts left)`),setTimeout(()=>r(a,l-1,0),e)}else{const n=function(e,t,o){const n=e.status;let r=`Status: ${t}, Error: ${o}`;if(e.responseText)try{const t=JSON.parse(e.responseText);t&&t.error&&(r+=`, Server Error: ${t.error}`)}catch(e){r+=", Unable to parse server response."}switch(n){case 0:return"Network Error: The server is unreachable.";case 400:return"Bad Request: The input URL might be incorrect.";case 401:return"Unauthorized: Please check the API key.";case 429:return"Too Many Requests: You are being rate-limited.";case 503:return"Service Unavailable: The server is temporarily overloaded.";default:return`${r}, HTTP ${n}: ${e.statusText||o}`}}(e,t,o);console.error(`All API endpoints failed. Error Details: ${n}`),i("Unable to fetch the download link after trying multiple services. This might be due to CORS restrictions or API limitations. Please try again later or contact support."),document.getElementById("loading").style.display="none"}},complete:function(){document.getElementById("downloadBtn").disabled=!1}})}function i(e){const t=document.getElementById("error");t?(t.innerHTML=o(e),t.style.display="block"):alert(e)}document.getElementById("downloadBtn").addEventListener("click",function(e,t){let o;return function(...n){clearTimeout(o),o=setTimeout(()=>e.apply(this,n),t)}}(function(){document.getElementById("loading").style.display="initial",document.getElementById("downloadBtn").disabled=!0;const e=document.getElementById("inputUrl").value.trim();if(!e)return i("Please enter a valid video URL."),document.getElementById("loading").style.display="none",void(document.getElementById("downloadBtn").disabled=!1);r(e)},300))}();
